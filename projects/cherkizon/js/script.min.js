"use strict";!function(){var t,o=document.querySelector(".map"),e=document.querySelectorAll(".about-map"),i=document.querySelectorAll(".map-card"),c=document.querySelector(".map-pin"),n=document.querySelectorAll("map-pin__button"),s=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,r=function(r){t.forEach(function(e,t){if(e.classList.contains("active")&&e.classList.remove("active"),r.target===e||e===document.activeElement){c.classList.add("map-pin--shown"),i.forEach(function(e){e.classList.contains("map-card--shown")&&(e.classList.remove("map-card--shown"),e.removeAttribute("style"),e.classList.add("map-card--hidden"))});var n=e.getBoundingClientRect();i[t].classList.add("map-card--shown"),i[t].classList.remove("map-card--hidden"),e.classList.add("active"),s<767&&(i[t].style.right="20px"),768<s&&(i[t].style.left=n.left-i[t].offsetWidth/3+"px"),i[t].style.top=n.top-o.getBoundingClientRect().top-i[t].getBoundingClientRect().height-50+"px",c.classList.add("map-pin--shown"),c.style.left=n.left+c.getBoundingClientRect().width/4+"px",c.style.top=n.top-o.getBoundingClientRect().top-75+"px"}})};function a(){c.classList.remove("map-pin--shown"),c.removeAttribute("style"),i.forEach(function(e){e.classList.contains("map-card--shown")&&(e.classList.remove("map-card--shown"),e.removeAttribute("style"),e.classList.add("map-card--hidden"))}),e.forEach(function(e){0<e.getBoundingClientRect().width&&(e.addEventListener("mouseover",r),e.addEventListener("mouseout",a),t=e.querySelectorAll(".map-part"))})}n.forEach(function(e,t){e.addEventListener("click",function(e){e.preventDefault(),i[t].classList.remove("map-card--shown"),i[t].removeAttribute("style"),i[t].classList.add("map-card--hidden")})}),a(),window.addEventListener("resize",function(){a()})}(),function(){if(767<window.innerWidth)for(var e=new ScrollMagic.Controller,t=document.querySelectorAll(".animated-block"),n=0;n<t.length;n++)new ScrollMagic.Scene({triggerElement:t[n]}).setClassToggle(t[n],"show").reverse(!1).addTo(e)}(),function(){var n,r,e=document.querySelectorAll(".brand__button"),t=document.querySelectorAll(".brand__logo"),o=document.querySelectorAll(".brand__description");n=t,r=o,e.forEach(function(e,t){e.addEventListener("click",function(){"Подробнее"===e.textContent?(e.textContent="Закрыть",e.classList.remove("brand__button--open"),n[t].classList.remove("brand__logo--fade-in"),n[t].classList.add("brand__logo--hidden"),setTimeout(function(){n[t].style.display="none",r[t].classList.remove("brand__description--hidden"),r[t].classList.add("brand__description--shown")},500)):"Закрыть"===e.textContent&&(e.textContent="Подробнее",e.classList.add("brand__button--open"),r[t].classList.add("brand__description--fade-out"),setTimeout(function(){r[t].classList.remove("brand__description--shown"),r[t].classList.add("brand__description--hidden"),r[t].classList.remove("brand__description--fade-out"),n[t].removeAttribute("style"),n[t].classList.remove("brand__logo--hidden"),n[t].classList.add("brand__logo--fade-in")},500))})})}(),function(){var o=void 0;function e(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=document.querySelectorAll(".brands-wrapper"),n=document.querySelectorAll(".brands__container"),r=document.querySelectorAll(".brand");e<1023&&void 0===o?(t.forEach(function(e){e.classList.add("swiper-container")}),n.forEach(function(e){e.classList.add("swiper-wrapper")}),r.forEach(function(e){e.classList.add("swiper-slide")}),o=new Swiper(".swiper-container",{direction:"horizontal",loop:!1,spaceBetween:10,breakpoints:{767:{spaceBetween:10,slidesOffsetBefore:30,width:260},1023:{spaceBetween:20,slidesOffsetBefore:60,width:540}}})):1023<e&&void 0!==o&&(document.querySelectorAll(".swiper-container").forEach(function(e){e.swiper.destroy()}),o=void 0,document.querySelectorAll(".swiper-wrapper").forEach(function(e){e.removeAttribute("style")}),document.querySelectorAll(".swiper-slide").forEach(function(e){e.removeAttribute("style")}),t.forEach(function(e){e.classList.remove("swiper-container")}),n.forEach(function(e){e.classList.remove("swiper-wrapper")}),r.forEach(function(e){e.classList.remove("swiper-slide")}))}e(),window.addEventListener("resize",function(){e()})}(),function(){var o=void 0;function e(){var e=$(window).width(),t=document.querySelectorAll(".career-people__slider"),n=document.querySelectorAll(".career-people__wrapper"),r=document.querySelectorAll(".career-people__item");e<1023&&null==o?(t.forEach(function(e){e.classList.add("swiper-container")}),n.forEach(function(e){e.classList.add("swiper-wrapper")}),r.forEach(function(e){e.classList.add("swiper-slide")}),o=new Swiper(".swiper-container",{direction:"horizontal",loop:!1})):1023<e&&null!=o&&($(".swiper-container").each(function(){this.swiper.destroy()}),o=void 0,t.forEach(function(e){e.classList.remove("swiper-container")}),n.forEach(function(e){e.classList.remove("swiper-wrapper")}),r.forEach(function(e){e.classList.remove("swiper-slide")}),jQuery(".swiper-wrapper").removeAttr("style"),jQuery(".swiper-slide").removeAttr("style"))}e(),$(window).on("resize",function(){e()}),767<window.innerWidth&&(document.querySelector(".career-join__title").textContent="Как присоединиться к нашей команде")}(),function(){var o=document.querySelector(".red-dot"),t=document.querySelectorAll(".timeline-dot"),i=document.querySelectorAll(".timeline-date"),c=document.querySelectorAll(".timeline__cards"),n=new PlainDraggable(o);PlainDraggable.draggableCursor="grab",PlainDraggable.draggingCursor="grabbing";var e=function(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;e<767?n.snap={x:{start:65,step:67,center:!0},y:0}:767<e&&e<1023?n.snap={x:{start:65,step:67,center:!0},y:0}:1023<e&&e<1439?n.snap={x:{start:55,step:67,center:!0,end:871},y:0}:1439<e&&(n.snap={x:{start:105,step:87,center:!0,end:1200},y:0}),t.forEach(function(e,t){var n=o.getBoundingClientRect(),r=e.getBoundingClientRect();n.left>r.left-15&&n.left<r.left+5&&(i.forEach(function(e,t){e.removeAttribute("style"),c[t].style.cssText="display: none;"}),i[t].style.cssText="color: rgba(208, 2, 27, 1);",c[t].style.cssText="display: flex;")})};e(),n.onMove=e,n.onDrag=function(e){return!!e.snapped},window.addEventListener("resize",function(){e()})}(),$(document).ready(function(){$("#feedback-form__tel").mask("+9 (999) 999-9999")}),document.createElement("main"),function(){var o=void 0;function e(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=document.querySelectorAll(".investors-slider-container"),n=document.querySelectorAll(".investors-slider-container .item__content"),r=document.querySelectorAll(".item-card");e<767&&void 0===o?(t.forEach(function(e){e.classList.add("swiper-container")}),n.forEach(function(e){e.classList.add("swiper-wrapper")}),r.forEach(function(e){e.classList.add("swiper-slide")}),o=new Swiper(".swiper-container",{direction:"horizontal",loop:!1,spaceBetween:8,slidesOffsetAfter:30,slidesPerView:"auto"})):767<e&&void 0!==o&&(document.querySelectorAll(".swiper-container").forEach(function(e){e.swiper.destroy()}),o=void 0,document.querySelectorAll(".swiper-wrapper").forEach(function(e){e.removeAttribute("style")}),document.querySelectorAll(".swiper-slide").forEach(function(e){e.removeAttribute("style")}),t.forEach(function(e){e.classList.remove("swiper-container")}),n.forEach(function(e){e.classList.remove("swiper-wrapper")}),r.forEach(function(e){e.classList.remove("swiper-slide")}))}e(),window.addEventListener("resize",function(){e()})}(),function(){if(window.innerWidth<768){var e=document.querySelector(".directions"),t=e.children[0],n=e.querySelectorAll(".directions__item"),r=e.children[1];e.classList.add("swiper-container"),t.classList.add("swiper-wrapper"),r.classList.add("swiper-pagination");for(var o=0;o<n.length;o++)n[o].classList.add("swiper-slide")}if(767<window.innerWidth){$.scrollify({section:".screen"});var i=new ScrollMagic.Controller;new ScrollMagic.Scene({offset:125}).setClassToggle("#sidebar","show").addTo(i);new ScrollMagic.Scene({triggerElement:".numbers"}).setClassToggle("#numbers","animate").addTo(i),new ScrollMagic.Scene({triggerElement:".news"}).setClassToggle("#news","animate").addTo(i);var c=document.querySelectorAll(".directions__item");for(o=0;o<c.length;o++)new ScrollMagic.Scene({triggerElement:c[o],triggerHook:0}).setPin(c[o]).addTo(i);for(o=1;o<c.length;o++)new ScrollMagic.Scene({triggerElement:c[o],triggerHook:0}).setClassToggle(c[o],"show").addTo(i);for(o=1;o<c.length;o++)new ScrollMagic.Scene({triggerElement:c[o],triggerHook:0}).setClassToggle(c[o-1],"fade").addTo(i);new ScrollMagic.Scene({triggerElement:".video",triggerHook:0}).addTo(i);var s=document.querySelector("main"),a=(s.querySelector(".career"),document.createElement("div"));a.id="fake-career",a.style.height="100vh",a.classList.add("screen"),s.appendChild(a),new ScrollMagic.Scene({triggerElement:"#video",triggerHook:0}).setClassToggle("#career","fixed").addTo(i),new ScrollMagic.Scene({triggerElement:"#video",triggerHook:0}).setClassToggle("#career","animate").addTo(i),new ScrollMagic.Scene({triggerElement:"#video",triggerHook:0}).setClassToggle("#footer","animate").addTo(i)}}(),function(){if(window.innerWidth<768&&document.querySelector(".swiper-container"))new Swiper(".swiper-container",{pagination:{el:".swiper-pagination"}})}(),function(){var e=document.querySelector(".sidebar"),t=e.querySelector(".sidebar__button");e&&t.addEventListener("click",function(){t.classList.toggle("sidebar__button--close")})}(),function(){var e=document.querySelector(".popup__button"),t=document.querySelector(".popup__container");e.addEventListener("click",function(e){e.preventDefault(),t.classList.add("popup__container--close")})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFib3V0LW1hcC5qcyIsImFuaW1hdGVkLWJsb2NrLmpzIiwiYnJhbmRzLmpzIiwiY2FyZWVyLmpzIiwiZHJhZ2dhYmxlLmpzIiwiZm9ybS5qcyIsImllLXN1cHBvcnQuanMiLCJpbnZlc3RvcnMuanMiLCJtYWluLmpzIiwibWVudS5qcyIsInBvcHVwLmpzIl0sIm5hbWVzIjpbInBhcnRzIiwibWFwIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibWFwcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJjYXJkcyIsIm1hcFBpbiIsIm1hcFBpbkNsb3NlIiwic2NyZWVuV2lkdGgiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwiZG9jdW1lbnRFbGVtZW50IiwiY2xpZW50V2lkdGgiLCJib2R5IiwibWFwQ2FyZEhhbmRsZXIiLCJldnQiLCJmb3JFYWNoIiwiZWxlbSIsImkiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsInJlbW92ZSIsInRhcmdldCIsImFjdGl2ZUVsZW1lbnQiLCJhZGQiLCJlbGVtZW50IiwicmVtb3ZlQXR0cmlidXRlIiwicmVjdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInN0eWxlIiwicmlnaHQiLCJsZWZ0Iiwib2Zmc2V0V2lkdGgiLCJ0b3AiLCJoZWlnaHQiLCJ3aWR0aCIsImluaXRNYXAiLCJhZGRFdmVudExpc3RlbmVyIiwiZWwiLCJrIiwicHJldmVudERlZmF1bHQiLCJjb250cm9sbGVyIiwiU2Nyb2xsTWFnaWMiLCJDb250cm9sbGVyIiwiYW5pbWF0ZWRCbG9ja3MiLCJsZW5ndGgiLCJTY2VuZSIsInRyaWdnZXJFbGVtZW50Iiwic2V0Q2xhc3NUb2dnbGUiLCJyZXZlcnNlIiwiYWRkVG8iLCJsb2dvIiwiZGVzY3JpcHRpb24iLCJicmFuZEJ1dHRvbiIsImJyYW5kTG9nbyIsImJyYW5kRGVzY3JpcHRpb24iLCJ0ZXh0Q29udGVudCIsInNldFRpbWVvdXQiLCJkaXNwbGF5IiwibXlTd2lwZXIiLCJ1bmRlZmluZWQiLCJpbml0U3dpcGVyIiwiaXRlbXMiLCJzbGlkZVdyYXBwZXJzIiwic2xpZGVzIiwiU3dpcGVyIiwiZGlyZWN0aW9uIiwibG9vcCIsInNwYWNlQmV0d2VlbiIsImJyZWFrcG9pbnRzIiwiNzY3Iiwic2xpZGVzT2Zmc2V0QmVmb3JlIiwiMTAyMyIsInN3aXBlciIsImRlc3Ryb3kiLCIkIiwiZWFjaCIsInRoaXMiLCJqUXVlcnkiLCJyZW1vdmVBdHRyIiwib24iLCJyZWRQaW4iLCJkb3RzIiwiZGF0ZXMiLCJkcmFnZ2FibGUiLCJQbGFpbkRyYWdnYWJsZSIsImRyYWdnYWJsZUN1cnNvciIsImRyYWdnaW5nQ3Vyc29yIiwiaW5pdFRpbWVsaW5lIiwic25hcCIsIngiLCJzdGFydCIsInN0ZXAiLCJjZW50ZXIiLCJ5IiwiZW5kIiwicmVjdDEiLCJyZWN0MiIsIm4iLCJjc3NUZXh0Iiwib25Nb3ZlIiwib25EcmFnIiwibmV3UG9zaXRpb24iLCJzbmFwcGVkIiwicmVhZHkiLCJtYXNrIiwiY3JlYXRlRWxlbWVudCIsInNsaWRlc09mZnNldEFmdGVyIiwic2xpZGVzUGVyVmlldyIsImNvbnRhaW5lciIsIndyYXBwZXIiLCJjaGlsZHJlbiIsInBhZ2luYXRpb24iLCJzY3JvbGxpZnkiLCJzZWN0aW9uIiwib2Zmc2V0IiwiZGlyZWN0aW9ucyIsInRyaWdnZXJIb29rIiwic2V0UGluIiwibWFpbiIsImZha2VTY3JlZW4iLCJpZCIsImFwcGVuZENoaWxkIiwic2lkZWJhciIsImJ1dHRvbiIsInRvZ2dsZSIsImNvbnRlbnQiXSwibWFwcGluZ3MiOiJBQUFBLGNBRUEsV0FDQSxJQU1BQSxFQU5BQyxFQUFBQyxTQUFBQyxjQUFBLFFBQ0FDLEVBQUFGLFNBQUFHLGlCQUFBLGNBQ0FDLEVBQUFKLFNBQUFHLGlCQUFBLGFBQ0FFLEVBQUFMLFNBQUFDLGNBQUEsWUFDQUssRUFBQU4sU0FBQUcsaUJBQUEsbUJBQ0FJLEVBQUFDLE9BQUFDLFlBQUFULFNBQUFVLGdCQUFBQyxhQUFBWCxTQUFBWSxLQUFBRCxZQUdBRSxFQUFBLFNBQUFDLEdBQ0FoQixFQUFBaUIsUUFBQSxTQUFBQyxFQUFBQyxHQU1BLEdBSkFELEVBQUFFLFVBQUFDLFNBQUEsV0FDQUgsRUFBQUUsVUFBQUUsT0FBQSxVQUdBTixFQUFBTyxTQUFBTCxHQUFBQSxJQUFBaEIsU0FBQXNCLGNBQUEsQ0FFQWpCLEVBQUFhLFVBQUFLLElBQUEsa0JBRUFuQixFQUFBVyxRQUFBLFNBQUFTLEdBQ0FBLEVBQUFOLFVBQUFDLFNBQUEscUJBQ0FLLEVBQUFOLFVBQUFFLE9BQUEsbUJBQ0FJLEVBQUFDLGdCQUFBLFNBQ0FELEVBQUFOLFVBQUFLLElBQUEsdUJBSUEsSUFBQUcsRUFBQVYsRUFBQVcsd0JBQ0F2QixFQUFBYSxHQUFBQyxVQUFBSyxJQUFBLG1CQUNBbkIsRUFBQWEsR0FBQUMsVUFBQUUsT0FBQSxvQkFDQUosRUFBQUUsVUFBQUssSUFBQSxVQUNBaEIsRUFBQSxNQUNBSCxFQUFBYSxHQUFBVyxNQUFBQyxNQUFBLFFBR0EsSUFBQXRCLElBQ0FILEVBQUFhLEdBQUFXLE1BQUFFLEtBQUFKLEVBQUFJLEtBQUExQixFQUFBYSxHQUFBYyxZQUFBLEVBQUEsTUFHQTNCLEVBQUFhLEdBQUFXLE1BQUFJLElBQUFOLEVBQUFNLElBQUFqQyxFQUFBNEIsd0JBQUFLLElBQUE1QixFQUFBYSxHQUFBVSx3QkFBQU0sT0FBQSxHQUFBLEtBQ0E1QixFQUFBYSxVQUFBSyxJQUFBLGtCQUNBbEIsRUFBQXVCLE1BQUFFLEtBQUFKLEVBQUFJLEtBQUF6QixFQUFBc0Isd0JBQUFPLE1BQUEsRUFBQSxLQUNBN0IsRUFBQXVCLE1BQUFJLElBQUFOLEVBQUFNLElBQUFqQyxFQUFBNEIsd0JBQUFLLElBQUEsR0FBQSxTQUtBLFNBQUFHLElBRUE5QixFQUFBYSxVQUFBRSxPQUFBLGtCQUNBZixFQUFBb0IsZ0JBQUEsU0FFQXJCLEVBQUFXLFFBQUEsU0FBQVMsR0FDQUEsRUFBQU4sVUFBQUMsU0FBQSxxQkFDQUssRUFBQU4sVUFBQUUsT0FBQSxtQkFDQUksRUFBQUMsZ0JBQUEsU0FDQUQsRUFBQU4sVUFBQUssSUFBQSx1QkFJQXJCLEVBQUFhLFFBQUEsU0FBQUMsR0FDQSxFQUFBQSxFQUFBVyx3QkFBQU8sUUFDQWxCLEVBQUFvQixpQkFBQSxZQUFBdkIsR0FDQUcsRUFBQW9CLGlCQUFBLFdBQUFELEdBQ0FyQyxFQUFBa0IsRUFBQWIsaUJBQUEsZ0JBS0FHLEVBQUFTLFFBQUEsU0FBQXNCLEVBQUFDLEdBQ0FELEVBQUFELGlCQUFBLFFBQUEsU0FBQXRCLEdBQ0FBLEVBQUF5QixpQkFDQW5DLEVBQUFrQyxHQUFBcEIsVUFBQUUsT0FBQSxtQkFDQWhCLEVBQUFrQyxHQUFBYixnQkFBQSxTQUNBckIsRUFBQWtDLEdBQUFwQixVQUFBSyxJQUFBLHdCQUlBWSxJQUVBM0IsT0FBQTRCLGlCQUFBLFNBQUEsV0FDQUQsTUFsRkEsR0NGQSxXQUNBLEdBQUEsSUFBQTNCLE9BQUFDLFdBSUEsSUFIQSxJQUFBK0IsRUFBQSxJQUFBQyxZQUFBQyxXQUNBQyxFQUFBM0MsU0FBQUcsaUJBQUEsbUJBRUFjLEVBQUEsRUFBQUEsRUFBQTBCLEVBQUFDLE9BQUEzQixJQUNBLElBQUF3QixZQUFBSSxNQUFBLENBQ0FDLGVBQUFILEVBQUExQixLQUVBOEIsZUFBQUosRUFBQTFCLEdBQUEsUUFDQStCLFNBQUEsR0FDQUMsTUFBQVQsR0FYQSxHQ0VBLFdBQ0EsSUFJQVUsRUFBQUMsRUFKQUMsRUFBQXBELFNBQUFHLGlCQUFBLGtCQUNBa0QsRUFBQXJELFNBQUFHLGlCQUFBLGdCQUNBbUQsRUFBQXRELFNBQUFHLGlCQUFBLHVCQUVBK0MsRUFpQ0FHLEVBakNBRixFQWlDQUcsRUFBQUYsRUFoQ0FyQyxRQUFBLFNBQUFDLEVBQUFDLEdBQ0FELEVBQUFvQixpQkFBQSxRQUFBLFdBQ0EsY0FBQXBCLEVBQUF1QyxhQUNBdkMsRUFBQXVDLFlBQUEsVUFDQXZDLEVBQUFFLFVBQUFFLE9BQUEsdUJBRUE4QixFQUFBakMsR0FBQUMsVUFBQUUsT0FBQSx3QkFDQThCLEVBQUFqQyxHQUFBQyxVQUFBSyxJQUFBLHVCQUVBaUMsV0FBQSxXQUNBTixFQUFBakMsR0FBQVcsTUFBQTZCLFFBQUEsT0FDQU4sRUFBQWxDLEdBQUFDLFVBQUFFLE9BQUEsOEJBQ0ErQixFQUFBbEMsR0FBQUMsVUFBQUssSUFBQSw4QkFDQSxNQUVBLFlBQUFQLEVBQUF1QyxjQUNBdkMsRUFBQXVDLFlBQUEsWUFDQXZDLEVBQUFFLFVBQUFLLElBQUEsdUJBQ0E0QixFQUFBbEMsR0FBQUMsVUFBQUssSUFBQSxnQ0FFQWlDLFdBQUEsV0FDQUwsRUFBQWxDLEdBQUFDLFVBQUFFLE9BQUEsNkJBQ0ErQixFQUFBbEMsR0FBQUMsVUFBQUssSUFBQSw4QkFDQTRCLEVBQUFsQyxHQUFBQyxVQUFBRSxPQUFBLGdDQUNBOEIsRUFBQWpDLEdBQUFRLGdCQUFBLFNBQ0F5QixFQUFBakMsR0FBQUMsVUFBQUUsT0FBQSx1QkFDQThCLEVBQUFqQyxHQUFBQyxVQUFBSyxJQUFBLHlCQUNBLFVBakNBLEdBMENBLFdBRUEsSUFBQW1DLE9BQUFDLEVBRUEsU0FBQUMsSUFDQSxJQUFBckQsRUFBQUMsT0FBQUMsWUFBQVQsU0FBQVUsZ0JBQUFDLGFBQUFYLFNBQUFZLEtBQUFELFlBQ0FrRCxFQUFBN0QsU0FBQUcsaUJBQUEsbUJBQ0EyRCxFQUFBOUQsU0FBQUcsaUJBQUEsc0JBQ0E0RCxFQUFBL0QsU0FBQUcsaUJBQUEsVUFFQUksRUFBQSxXQUFBb0QsSUFBQUQsR0FFQUcsRUFBQTlDLFFBQUEsU0FBQUMsR0FDQUEsRUFBQUUsVUFBQUssSUFBQSxzQkFHQXVDLEVBQUEvQyxRQUFBLFNBQUFDLEdBQ0FBLEVBQUFFLFVBQUFLLElBQUEsb0JBR0F3QyxFQUFBaEQsUUFBQSxTQUFBQyxHQUNBQSxFQUFBRSxVQUFBSyxJQUFBLGtCQUdBbUMsRUFBQSxJQUFBTSxPQUFBLG9CQUFBLENBQ0FDLFVBQUEsYUFDQUMsTUFBQSxFQUNBQyxhQUFBLEdBRUFDLFlBQUEsQ0FFQUMsSUFBQSxDQUNBRixhQUFBLEdBQ0FHLG1CQUFBLEdBQ0FwQyxNQUFBLEtBR0FxQyxLQUFBLENBQ0FKLGFBQUEsR0FDQUcsbUJBQUEsR0FDQXBDLE1BQUEsU0FJQSxLQUFBM0IsUUFBQW9ELElBQUFELElBRUExRCxTQUFBRyxpQkFBQSxxQkFBQVksUUFBQSxTQUFBQyxHQUNBQSxFQUFBd0QsT0FBQUMsWUFHQWYsT0FBQUMsRUFFQTNELFNBQUFHLGlCQUFBLG1CQUFBWSxRQUFBLFNBQUFDLEdBQ0FBLEVBQUFTLGdCQUFBLFdBRUF6QixTQUFBRyxpQkFBQSxpQkFBQVksUUFBQSxTQUFBQyxHQUNBQSxFQUFBUyxnQkFBQSxXQUdBb0MsRUFBQTlDLFFBQUEsU0FBQUMsR0FDQUEsRUFBQUUsVUFBQUUsT0FBQSxzQkFHQTBDLEVBQUEvQyxRQUFBLFNBQUFDLEdBQ0FBLEVBQUFFLFVBQUFFLE9BQUEsb0JBR0EyQyxFQUFBaEQsUUFBQSxTQUFBQyxHQUNBQSxFQUFBRSxVQUFBRSxPQUFBLG1CQUtBd0MsSUFFQXBELE9BQUE0QixpQkFBQSxTQUFBLFdBQ0F3QixNQTVFQSxHQzFDQSxXQUVBLElBQUFGLE9BQUFDLEVBRUEsU0FBQUMsSUFDQSxJQUFBckQsRUFBQW1FLEVBQUFsRSxRQUFBMEIsUUFDQTJCLEVBQUE3RCxTQUFBRyxpQkFBQSwwQkFDQTJELEVBQUE5RCxTQUFBRyxpQkFBQSwyQkFDQTRELEVBQUEvRCxTQUFBRyxpQkFBQSx3QkFFQUksRUFBQSxNQUFBb0QsTUFBQUQsR0FFQUcsRUFBQTlDLFFBQUEsU0FBQUMsR0FDQUEsRUFBQUUsVUFBQUssSUFBQSxzQkFHQXVDLEVBQUEvQyxRQUFBLFNBQUFDLEdBQ0FBLEVBQUFFLFVBQUFLLElBQUEsb0JBR0F3QyxFQUFBaEQsUUFBQSxTQUFBQyxHQUNBQSxFQUFBRSxVQUFBSyxJQUFBLGtCQUdBbUMsRUFBQSxJQUFBTSxPQUFBLG9CQUFBLENBQ0FDLFVBQUEsYUFDQUMsTUFBQSxLQUtBLEtBQUEzRCxHQUFBb0QsTUFBQUQsSUFFQWdCLEVBQUEscUJBQUFDLEtBQUEsV0FDQUMsS0FBQUosT0FBQUMsWUFHQWYsT0FBQUMsRUFFQUUsRUFBQTlDLFFBQUEsU0FBQUMsR0FDQUEsRUFBQUUsVUFBQUUsT0FBQSxzQkFHQTBDLEVBQUEvQyxRQUFBLFNBQUFDLEdBQ0FBLEVBQUFFLFVBQUFFLE9BQUEsb0JBR0EyQyxFQUFBaEQsUUFBQSxTQUFBQyxHQUNBQSxFQUFBRSxVQUFBRSxPQUFBLGtCQUdBeUQsT0FBQSxtQkFBQUMsV0FBQSxTQUNBRCxPQUFBLGlCQUFBQyxXQUFBLFVBTUFsQixJQUlBYyxFQUFBbEUsUUFBQXVFLEdBQUEsU0FBQSxXQUNBbkIsTUFHQSxJQUFBcEQsT0FBQUMsYUFDQVQsU0FBQUMsY0FBQSx1QkFBQXNELFlBQUEsc0NBbkVBLEdDQUEsV0FDQSxJQUFBeUIsRUFBQWhGLFNBQUFDLGNBQUEsWUFFQWdGLEVBQUFqRixTQUFBRyxpQkFBQSxpQkFDQStFLEVBQUFsRixTQUFBRyxpQkFBQSxrQkFDQUMsRUFBQUosU0FBQUcsaUJBQUEsb0JBRUFnRixFQUFBLElBQUFDLGVBQUFKLEdBRUFJLGVBQUFDLGdCQUFBLE9BQ0FELGVBQUFFLGVBQUEsV0FFQSxJQUFBQyxFQUFBLFdBQ0EsSUFBQWhGLEVBQUFDLE9BQUFDLFlBQUFULFNBQUFVLGdCQUFBQyxhQUFBWCxTQUFBWSxLQUFBRCxZQUVBSixFQUFBLElBQ0E0RSxFQUFBSyxLQUFBLENBQUFDLEVBQUEsQ0FBQUMsTUFBQSxHQUFBQyxLQUFBLEdBQUFDLFFBQUEsR0FBQUMsRUFBQSxHQUNBLElBQUF0RixHQUFBQSxFQUFBLEtBQ0E0RSxFQUFBSyxLQUFBLENBQUFDLEVBQUEsQ0FBQUMsTUFBQSxHQUFBQyxLQUFBLEdBQUFDLFFBQUEsR0FBQUMsRUFBQSxHQUNBLEtBQUF0RixHQUFBQSxFQUFBLEtBQ0E0RSxFQUFBSyxLQUFBLENBQUFDLEVBQUEsQ0FBQUMsTUFBQSxHQUFBQyxLQUFBLEdBQUFDLFFBQUEsRUFBQUUsSUFBQSxLQUFBRCxFQUFBLEdBQ0EsS0FBQXRGLElBQ0E0RSxFQUFBSyxLQUFBLENBQUFDLEVBQUEsQ0FBQUMsTUFBQSxJQUFBQyxLQUFBLEdBQUFDLFFBQUEsRUFBQUUsSUFBQSxNQUFBRCxFQUFBLElBR0FaLEVBQUFsRSxRQUFBLFNBQUFDLEVBQUFDLEdBQ0EsSUFBQThFLEVBQUFmLEVBQUFyRCx3QkFDQXFFLEVBQUFoRixFQUFBVyx3QkFDQW9FLEVBQUFqRSxLQUFBa0UsRUFBQWxFLEtBQUEsSUFBQWlFLEVBQUFqRSxLQUFBa0UsRUFBQWxFLEtBQUEsSUFDQW9ELEVBQUFuRSxRQUFBLFNBQUFzQixFQUFBNEQsR0FDQTVELEVBQUFaLGdCQUFBLFNBQ0FyQixFQUFBNkYsR0FBQXJFLE1BQUFzRSxRQUFBLG1CQUVBaEIsRUFBQWpFLEdBQUFXLE1BQUFzRSxRQUFBLDhCQUNBOUYsRUFBQWEsR0FBQVcsTUFBQXNFLFFBQUEscUJBS0FYLElBRUFKLEVBQUFnQixPQUFBWixFQUNBSixFQUFBaUIsT0FBQSxTQUFBQyxHQUNBLFFBQUFBLEVBQUFDLFNBR0E5RixPQUFBNEIsaUJBQUEsU0FBQSxXQUNBbUQsTUEvQ0EsR0NBQWIsRUFBQTFFLFVBQUF1RyxNQUFBLFdBQ0E3QixFQUFBLHVCQUFBOEIsS0FBQSx1QkNBQXhHLFNBQUF5RyxjQUFBLFFDREEsV0FDQSxJQUFBL0MsT0FBQUMsRUFFQSxTQUFBQyxJQUNBLElBQUFyRCxFQUFBQyxPQUFBQyxZQUFBVCxTQUFBVSxnQkFBQUMsYUFBQVgsU0FBQVksS0FBQUQsWUFDQWtELEVBQUE3RCxTQUFBRyxpQkFBQSwrQkFDQTJELEVBQUE5RCxTQUFBRyxpQkFBQSw4Q0FDQTRELEVBQUEvRCxTQUFBRyxpQkFBQSxjQUVBSSxFQUFBLFVBQUFvRCxJQUFBRCxHQUVBRyxFQUFBOUMsUUFBQSxTQUFBQyxHQUNBQSxFQUFBRSxVQUFBSyxJQUFBLHNCQUdBdUMsRUFBQS9DLFFBQUEsU0FBQUMsR0FDQUEsRUFBQUUsVUFBQUssSUFBQSxvQkFHQXdDLEVBQUFoRCxRQUFBLFNBQUFDLEdBQ0FBLEVBQUFFLFVBQUFLLElBQUEsa0JBR0FtQyxFQUFBLElBQUFNLE9BQUEsb0JBQUEsQ0FDQUMsVUFBQSxhQUNBQyxNQUFBLEVBQ0FDLGFBQUEsRUFDQXVDLGtCQUFBLEdBQ0FDLGNBQUEsVUFHQSxJQUFBcEcsUUFBQW9ELElBQUFELElBRUExRCxTQUFBRyxpQkFBQSxxQkFBQVksUUFBQSxTQUFBQyxHQUNBQSxFQUFBd0QsT0FBQUMsWUFHQWYsT0FBQUMsRUFFQTNELFNBQUFHLGlCQUFBLG1CQUFBWSxRQUFBLFNBQUFDLEdBQ0FBLEVBQUFTLGdCQUFBLFdBRUF6QixTQUFBRyxpQkFBQSxpQkFBQVksUUFBQSxTQUFBQyxHQUNBQSxFQUFBUyxnQkFBQSxXQUdBb0MsRUFBQTlDLFFBQUEsU0FBQUMsR0FDQUEsRUFBQUUsVUFBQUUsT0FBQSxzQkFHQTBDLEVBQUEvQyxRQUFBLFNBQUFDLEdBQ0FBLEVBQUFFLFVBQUFFLE9BQUEsb0JBR0EyQyxFQUFBaEQsUUFBQSxTQUFBQyxHQUNBQSxFQUFBRSxVQUFBRSxPQUFBLG1CQUtBd0MsSUFFQXBELE9BQUE0QixpQkFBQSxTQUFBLFdBQ0F3QixNQS9EQSxHQ0FBLFdBQ0EsR0FBQXBELE9BQUFDLFdBQUEsSUFBQSxDQUNBLElBQUFtRyxFQUFBNUcsU0FBQUMsY0FBQSxlQUNBNEcsRUFBQUQsRUFBQUUsU0FBQSxHQUNBL0MsRUFBQTZDLEVBQUF6RyxpQkFBQSxxQkFDQTRHLEVBQUFILEVBQUFFLFNBQUEsR0FFQUYsRUFBQTFGLFVBQUFLLElBQUEsb0JBQ0FzRixFQUFBM0YsVUFBQUssSUFBQSxrQkFDQXdGLEVBQUE3RixVQUFBSyxJQUFBLHFCQUVBLElBQUEsSUFBQU4sRUFBQSxFQUFBQSxFQUFBOEMsRUFBQW5CLE9BQUEzQixJQUNBOEMsRUFBQTlDLEdBQUFDLFVBQUFLLElBQUEsZ0JBSUEsR0FBQSxJQUFBZixPQUFBQyxXQUFBLENBQ0FpRSxFQUFBc0MsVUFBQSxDQUNBQyxRQUFBLFlBR0EsSUFBQXpFLEVBQUEsSUFBQUMsWUFBQUMsV0FFQSxJQUFBRCxZQUFBSSxNQUFBLENBQ0FxRSxPQUFBLE1BRUFuRSxlQUFBLFdBQUEsUUFDQUUsTUFBQVQsR0FFQSxJQUFBQyxZQUFBSSxNQUFBLENBQ0FDLGVBQUEsYUFFQUMsZUFBQSxXQUFBLFdBQ0FFLE1BQUFULEdBRUEsSUFBQUMsWUFBQUksTUFBQSxDQUNBQyxlQUFBLFVBRUFDLGVBQUEsUUFBQSxXQUNBRSxNQUFBVCxHQVZBLElBWUEyRSxFQUFBbkgsU0FBQUcsaUJBQUEscUJBRUEsSUFBQWMsRUFBQSxFQUFBQSxFQUFBa0csRUFBQXZFLE9BQUEzQixJQUNBLElBQUF3QixZQUFBSSxNQUFBLENBQ0FDLGVBQUFxRSxFQUFBbEcsR0FDQW1HLFlBQUEsSUFFQUMsT0FBQUYsRUFBQWxHLElBQ0FnQyxNQUFBVCxHQUdBLElBQUF2QixFQUFBLEVBQUFBLEVBQUFrRyxFQUFBdkUsT0FBQTNCLElBQ0EsSUFBQXdCLFlBQUFJLE1BQUEsQ0FDQUMsZUFBQXFFLEVBQUFsRyxHQUNBbUcsWUFBQSxJQUVBckUsZUFBQW9FLEVBQUFsRyxHQUFBLFFBQ0FnQyxNQUFBVCxHQUdBLElBQUF2QixFQUFBLEVBQUFBLEVBQUFrRyxFQUFBdkUsT0FBQTNCLElBQ0EsSUFBQXdCLFlBQUFJLE1BQUEsQ0FDQUMsZUFBQXFFLEVBQUFsRyxHQUNBbUcsWUFBQSxJQUVBckUsZUFBQW9FLEVBQUFsRyxFQUFBLEdBQUEsUUFDQWdDLE1BQUFULEdBR0EsSUFBQUMsWUFBQUksTUFBQSxDQUNBQyxlQUFBLFNBQ0FzRSxZQUFBLElBRUFuRSxNQUFBVCxHQUpBLElBTUE4RSxFQUFBdEgsU0FBQUMsY0FBQSxRQUVBc0gsR0FEQUQsRUFBQXJILGNBQUEsV0FDQUQsU0FBQXlHLGNBQUEsUUFFQWMsRUFBQUMsR0FBQSxjQUNBRCxFQUFBM0YsTUFBQUssT0FBQSxRQUNBc0YsRUFBQXJHLFVBQUFLLElBQUEsVUFDQStGLEVBQUFHLFlBQUFGLEdBRUEsSUFBQTlFLFlBQUFJLE1BQUEsQ0FDQUMsZUFBQSxTQUNBc0UsWUFBQSxJQUVBckUsZUFBQSxVQUFBLFNBQ0FFLE1BQUFULEdBRUEsSUFBQUMsWUFBQUksTUFBQSxDQUNBQyxlQUFBLFNBQ0FzRSxZQUFBLElBRUFyRSxlQUFBLFVBQUEsV0FDQUUsTUFBQVQsR0FFQSxJQUFBQyxZQUFBSSxNQUFBLENBQ0FDLGVBQUEsU0FDQXNFLFlBQUEsSUFFQXJFLGVBQUEsVUFBQSxXQUNBRSxNQUFBVCxJQXhHQSxHQTRHQSxXQUNBLEdBQUFoQyxPQUFBQyxXQUFBLEtBQUFULFNBQUFDLGNBQUEscUJBQ0EsSUFBQStELE9BQUEsb0JBQUEsQ0FDQStDLFdBQUEsQ0FDQTFFLEdBQUEsd0JBSkEsR0M1R0EsV0FDQSxJQUFBcUYsRUFBQTFILFNBQUFDLGNBQUEsWUFDQTBILEVBQUFELEVBQUF6SCxjQUFBLG9CQUVBeUgsR0FDQUMsRUFBQXZGLGlCQUFBLFFBQUEsV0FDQXVGLEVBQUF6RyxVQUFBMEcsT0FBQSw0QkFOQSxHQ0FBLFdBQ0EsSUFBQUQsRUFBQTNILFNBQUFDLGNBQUEsa0JBQ0E0SCxFQUFBN0gsU0FBQUMsY0FBQSxxQkFFQTBILEVBQUF2RixpQkFBQSxRQUFBLFNBQUF0QixHQUNBQSxFQUFBeUIsaUJBQ0FzRixFQUFBM0csVUFBQUssSUFBQSw2QkFOQSIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBtYXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWFwJyk7XG4gIHZhciBtYXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFib3V0LW1hcCcpO1xuICB2YXIgY2FyZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubWFwLWNhcmQnKTtcbiAgdmFyIG1hcFBpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tYXAtcGluJyk7XG4gIHZhciBtYXBQaW5DbG9zZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ21hcC1waW5fX2J1dHRvbicpO1xuICB2YXIgc2NyZWVuV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggfHwgZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDtcbiAgdmFyIHBhcnRzO1xuXG4gIHZhciBtYXBDYXJkSGFuZGxlciA9IGZ1bmN0aW9uIChldnQpIHtcbiAgICBwYXJ0cy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtLCBpKSB7XG5cbiAgICAgIGlmIChlbGVtLmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykpIHtcbiAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGV2dC50YXJnZXQgPT09IGVsZW0gfHwgZWxlbSA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkge1xuXG4gICAgICAgIG1hcFBpbi5jbGFzc0xpc3QuYWRkKCdtYXAtcGluLS1zaG93bicpO1xuXG4gICAgICAgIGNhcmRzLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICBpZiAoZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ21hcC1jYXJkLS1zaG93bicpKSB7XG4gICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ21hcC1jYXJkLS1zaG93bicpO1xuICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7XG4gICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ21hcC1jYXJkLS1oaWRkZW4nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciByZWN0ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgY2FyZHNbaV0uY2xhc3NMaXN0LmFkZCgnbWFwLWNhcmQtLXNob3duJyk7XG4gICAgICAgIGNhcmRzW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ21hcC1jYXJkLS1oaWRkZW4nKTtcbiAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgICAgaWYgKHNjcmVlbldpZHRoIDwgNzY3KSB7XG4gICAgICAgICAgY2FyZHNbaV0uc3R5bGUucmlnaHQgPSAnMjBweCc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc2NyZWVuV2lkdGggPiA3NjgpIHtcbiAgICAgICAgICBjYXJkc1tpXS5zdHlsZS5sZWZ0ID0gcmVjdC5sZWZ0IC0gKGNhcmRzW2ldLm9mZnNldFdpZHRoIC8gMykgKyAncHgnO1xuICAgICAgICB9XG5cbiAgICAgICAgY2FyZHNbaV0uc3R5bGUudG9wID0gcmVjdC50b3AgLSBtYXAuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wIC0gY2FyZHNbaV0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0IC0gNTAgKyAncHgnO1xuICAgICAgICBtYXBQaW4uY2xhc3NMaXN0LmFkZCgnbWFwLXBpbi0tc2hvd24nKTtcbiAgICAgICAgbWFwUGluLnN0eWxlLmxlZnQgPSByZWN0LmxlZnQgKyBtYXBQaW4uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGggLyA0ICsgJ3B4JztcbiAgICAgICAgbWFwUGluLnN0eWxlLnRvcCA9IHJlY3QudG9wIC0gbWFwLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCAtIDc1ICsgJ3B4JztcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICBmdW5jdGlvbiBpbml0TWFwKCkge1xuXG4gICAgbWFwUGluLmNsYXNzTGlzdC5yZW1vdmUoJ21hcC1waW4tLXNob3duJyk7XG4gICAgbWFwUGluLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTtcblxuICAgIGNhcmRzLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIGlmIChlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnbWFwLWNhcmQtLXNob3duJykpIHtcbiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdtYXAtY2FyZC0tc2hvd24nKTtcbiAgICAgICAgZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7XG4gICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnbWFwLWNhcmQtLWhpZGRlbicpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgbWFwcy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICBpZiAoZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCA+IDApIHtcbiAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCBtYXBDYXJkSGFuZGxlcik7XG4gICAgICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCBpbml0TWFwKTtcbiAgICAgICAgcGFydHMgPSBlbGVtLnF1ZXJ5U2VsZWN0b3JBbGwoJy5tYXAtcGFydCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgbWFwUGluQ2xvc2UuZm9yRWFjaChmdW5jdGlvbiAoZWwsIGspIHtcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChldnQpIHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY2FyZHNba10uY2xhc3NMaXN0LnJlbW92ZSgnbWFwLWNhcmQtLXNob3duJyk7XG4gICAgICBjYXJkc1trXS5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7XG4gICAgICBjYXJkc1trXS5jbGFzc0xpc3QuYWRkKCdtYXAtY2FyZC0taGlkZGVuJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGluaXRNYXAoKTtcblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZnVuY3Rpb24gKCkge1xuICAgIGluaXRNYXAoKTtcbiAgfSk7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICBpZiAod2luZG93LmlubmVyV2lkdGggPiA3NjcpIHtcbiAgICB2YXIgY29udHJvbGxlciA9IG5ldyBTY3JvbGxNYWdpYy5Db250cm9sbGVyKCk7XG4gICAgdmFyIGFuaW1hdGVkQmxvY2tzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFuaW1hdGVkLWJsb2NrJyk7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFuaW1hdGVkQmxvY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBuZXcgU2Nyb2xsTWFnaWMuU2NlbmUoe1xuICAgICAgICB0cmlnZ2VyRWxlbWVudDogYW5pbWF0ZWRCbG9ja3NbaV1cbiAgICAgIH0pXG4gICAgICAuc2V0Q2xhc3NUb2dnbGUoYW5pbWF0ZWRCbG9ja3NbaV0sICdzaG93JylcbiAgICAgIC5yZXZlcnNlKGZhbHNlKVxuICAgICAgLmFkZFRvKGNvbnRyb2xsZXIpO1xuICAgIH1cbiAgfVxufSkoKTtcbiIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGJyYW5kQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJyYW5kX19idXR0b24nKTtcbiAgdmFyIGJyYW5kTG9nbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5icmFuZF9fbG9nbycpO1xuICB2YXIgYnJhbmREZXNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5icmFuZF9fZGVzY3JpcHRpb24nKTtcblxuICB2YXIgYnJhbmRCdXR0b25IYW5kbGVyID0gZnVuY3Rpb24gKGJ1dHRvbiwgbG9nbywgZGVzY3JpcHRpb24pIHtcbiAgICBidXR0b24uZm9yRWFjaChmdW5jdGlvbiAoZWxlbSwgaSkge1xuICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGVsZW0udGV4dENvbnRlbnQgPT09ICfQn9C+0LTRgNC+0LHQvdC10LUnKSB7XG4gICAgICAgICAgZWxlbS50ZXh0Q29udGVudCA9ICfQl9Cw0LrRgNGL0YLRjCc7XG4gICAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdicmFuZF9fYnV0dG9uLS1vcGVuJyk7XG5cbiAgICAgICAgICBsb2dvW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2JyYW5kX19sb2dvLS1mYWRlLWluJyk7XG4gICAgICAgICAgbG9nb1tpXS5jbGFzc0xpc3QuYWRkKCdicmFuZF9fbG9nby0taGlkZGVuJyk7XG5cbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGxvZ29baV0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgZGVzY3JpcHRpb25baV0uY2xhc3NMaXN0LnJlbW92ZSgnYnJhbmRfX2Rlc2NyaXB0aW9uLS1oaWRkZW4nKTtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uW2ldLmNsYXNzTGlzdC5hZGQoJ2JyYW5kX19kZXNjcmlwdGlvbi0tc2hvd24nKTtcbiAgICAgICAgICB9LCA1MDApO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoZWxlbS50ZXh0Q29udGVudCA9PT0gJ9CX0LDQutGA0YvRgtGMJykge1xuICAgICAgICAgIGVsZW0udGV4dENvbnRlbnQgPSAn0J/QvtC00YDQvtCx0L3QtdC1JztcbiAgICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoJ2JyYW5kX19idXR0b24tLW9wZW4nKTtcbiAgICAgICAgICBkZXNjcmlwdGlvbltpXS5jbGFzc0xpc3QuYWRkKCdicmFuZF9fZGVzY3JpcHRpb24tLWZhZGUtb3V0Jyk7XG5cbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2JyYW5kX19kZXNjcmlwdGlvbi0tc2hvd24nKTtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uW2ldLmNsYXNzTGlzdC5hZGQoJ2JyYW5kX19kZXNjcmlwdGlvbi0taGlkZGVuJyk7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbltpXS5jbGFzc0xpc3QucmVtb3ZlKCdicmFuZF9fZGVzY3JpcHRpb24tLWZhZGUtb3V0Jyk7XG4gICAgICAgICAgICBsb2dvW2ldLnJlbW92ZUF0dHJpYnV0ZShcInN0eWxlXCIpO1xuICAgICAgICAgICAgbG9nb1tpXS5jbGFzc0xpc3QucmVtb3ZlKCdicmFuZF9fbG9nby0taGlkZGVuJyk7XG4gICAgICAgICAgICBsb2dvW2ldLmNsYXNzTGlzdC5hZGQoJ2JyYW5kX19sb2dvLS1mYWRlLWluJyk7XG4gICAgICAgICAgfSwgNTAwKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIGJyYW5kQnV0dG9uSGFuZGxlcihicmFuZEJ1dHRvbiwgYnJhbmRMb2dvLCBicmFuZERlc2NyaXB0aW9uKTtcbn0pKCk7XG5cblxuKGZ1bmN0aW9uICgpIHtcblxuICB2YXIgbXlTd2lwZXIgPSB1bmRlZmluZWQ7XG5cbiAgZnVuY3Rpb24gaW5pdFN3aXBlcigpIHtcbiAgICB2YXIgc2NyZWVuV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggfHwgZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDtcbiAgICB2YXIgaXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYnJhbmRzLXdyYXBwZXInKTtcbiAgICB2YXIgc2xpZGVXcmFwcGVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5icmFuZHNfX2NvbnRhaW5lcicpO1xuICAgIHZhciBzbGlkZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYnJhbmQnKTtcblxuICAgIGlmIChzY3JlZW5XaWR0aCA8IDEwMjMgJiYgbXlTd2lwZXIgPT09IHVuZGVmaW5lZCkge1xuXG4gICAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgnc3dpcGVyLWNvbnRhaW5lcicpO1xuICAgICAgfSk7XG5cbiAgICAgIHNsaWRlV3JhcHBlcnMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoJ3N3aXBlci13cmFwcGVyJyk7XG4gICAgICB9KTtcblxuICAgICAgc2xpZGVzLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCdzd2lwZXItc2xpZGUnKTtcbiAgICAgIH0pO1xuXG4gICAgICBteVN3aXBlciA9IG5ldyBTd2lwZXIoJy5zd2lwZXItY29udGFpbmVyJywge1xuICAgICAgICBkaXJlY3Rpb246ICdob3Jpem9udGFsJyxcbiAgICAgICAgbG9vcDogZmFsc2UsXG4gICAgICAgIHNwYWNlQmV0d2VlbjogMTAsXG4gICAgICAgIC8vIFJlc3BvbnNpdmUgYnJlYWtwb2ludHNcbiAgICAgICAgYnJlYWtwb2ludHM6IHtcbiAgICAgICAgICAvLyB3aGVuIHdpbmRvdyB3aWR0aCBpcyA8PSA3NjdweFxuICAgICAgICAgIDc2Nzoge1xuICAgICAgICAgICAgc3BhY2VCZXR3ZWVuOiAxMCxcbiAgICAgICAgICAgIHNsaWRlc09mZnNldEJlZm9yZTogMzAsXG4gICAgICAgICAgICB3aWR0aDogMjYwLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgLy8gd2hlbiB3aW5kb3cgd2lkdGggaXMgPD0gNDgwcHhcbiAgICAgICAgICAxMDIzOiB7XG4gICAgICAgICAgICBzcGFjZUJldHdlZW46IDIwLFxuICAgICAgICAgICAgc2xpZGVzT2Zmc2V0QmVmb3JlOiA2MCxcbiAgICAgICAgICAgIHdpZHRoOiA1NDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoc2NyZWVuV2lkdGggPiAxMDIzICYmIG15U3dpcGVyICE9PSB1bmRlZmluZWQpIHtcblxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnN3aXBlci1jb250YWluZXInKS5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIGVsZW0uc3dpcGVyLmRlc3Ryb3koKTtcbiAgICAgIH0pO1xuXG4gICAgICBteVN3aXBlciA9IHVuZGVmaW5lZDtcblxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnN3aXBlci13cmFwcGVyJykuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICBlbGVtLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTtcbiAgICAgIH0pO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnN3aXBlci1zbGlkZScpLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgZWxlbS5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7XG4gICAgICB9KTtcblxuICAgICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ3N3aXBlci1jb250YWluZXInKTtcbiAgICAgIH0pO1xuXG4gICAgICBzbGlkZVdyYXBwZXJzLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdzd2lwZXItd3JhcHBlcicpO1xuICAgICAgfSk7XG5cbiAgICAgIHNsaWRlcy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgnc3dpcGVyLXNsaWRlJyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBpbml0U3dpcGVyKCk7XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHtcbiAgICBpbml0U3dpcGVyKCk7XG4gIH0pO1xufSkoKTtcbiIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICB2YXIgbXlTd2lwZXIgPSB1bmRlZmluZWQ7XG5cbiAgZnVuY3Rpb24gaW5pdFN3aXBlcigpIHtcbiAgICB2YXIgc2NyZWVuV2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTtcbiAgICB2YXIgaXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2FyZWVyLXBlb3BsZV9fc2xpZGVyJyk7XG4gICAgdmFyIHNsaWRlV3JhcHBlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2FyZWVyLXBlb3BsZV9fd3JhcHBlcicpO1xuICAgIHZhciBzbGlkZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2FyZWVyLXBlb3BsZV9faXRlbScpO1xuXG4gICAgaWYgKHNjcmVlbldpZHRoIDwgMTAyMyAmJiBteVN3aXBlciA9PSB1bmRlZmluZWQpIHtcblxuICAgICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoJ3N3aXBlci1jb250YWluZXInKTtcbiAgICAgIH0pO1xuXG4gICAgICBzbGlkZVdyYXBwZXJzLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCdzd2lwZXItd3JhcHBlcicpO1xuICAgICAgfSk7XG5cbiAgICAgIHNsaWRlcy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgnc3dpcGVyLXNsaWRlJyk7XG4gICAgICB9KTtcblxuICAgICAgbXlTd2lwZXIgPSBuZXcgU3dpcGVyKCcuc3dpcGVyLWNvbnRhaW5lcicsIHtcbiAgICAgICAgZGlyZWN0aW9uOiAnaG9yaXpvbnRhbCcsXG4gICAgICAgIGxvb3A6IGZhbHNlLFxuICAgICAgICAvLyBzcGFjZUJldHdlZW46IDgsXG4gICAgICAgIC8vIHNsaWRlc09mZnNldEJlZm9yZTogMzAsXG4gICAgICAgIC8vIHdpZHRoOiAyNjAsXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHNjcmVlbldpZHRoID4gMTAyMyAmJiBteVN3aXBlciAhPSB1bmRlZmluZWQpIHtcblxuICAgICAgJCgnLnN3aXBlci1jb250YWluZXInKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zd2lwZXIuZGVzdHJveSgpO1xuICAgICAgfSk7XG5cbiAgICAgIG15U3dpcGVyID0gdW5kZWZpbmVkO1xuXG4gICAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgnc3dpcGVyLWNvbnRhaW5lcicpO1xuICAgICAgfSk7XG5cbiAgICAgIHNsaWRlV3JhcHBlcnMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ3N3aXBlci13cmFwcGVyJyk7XG4gICAgICB9KTtcblxuICAgICAgc2xpZGVzLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdzd2lwZXItc2xpZGUnKTtcbiAgICAgIH0pO1xuXG4gICAgICBqUXVlcnkoJy5zd2lwZXItd3JhcHBlcicpLnJlbW92ZUF0dHIoJ3N0eWxlJyk7XG4gICAgICBqUXVlcnkoJy5zd2lwZXItc2xpZGUnKS5yZW1vdmVBdHRyKCdzdHlsZScpO1xuICAgIH1cbiAgfVxuXG4gIC8vU3dpcGVyIHBsdWdpbiBpbml0aWFsaXphdGlvblxuXG4gIGluaXRTd2lwZXIoKTtcblxuICAvL1N3aXBlciBwbHVnaW4gaW5pdGlhbGl6YXRpb24gb24gd2luZG93IHJlc2l6ZVxuXG4gICQod2luZG93KS5vbigncmVzaXplJywgZnVuY3Rpb24gKCkge1xuICAgIGluaXRTd2lwZXIoKTtcbiAgfSk7XG5cbiAgaWYgKHdpbmRvdy5pbm5lcldpZHRoID4gNzY3KSB7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmVlci1qb2luX190aXRsZScpLnRleHRDb250ZW50ID0gJ9Ca0LDQuiDQv9GA0LjRgdC+0LXQtNC40L3QuNGC0YzRgdGPINC6INC90LDRiNC10Lkg0LrQvtC80LDQvdC00LUnO1xuICB9XG59KSgpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgcmVkUGluID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJlZC1kb3QnKTtcblxuICB2YXIgZG90cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50aW1lbGluZS1kb3QnKTtcbiAgdmFyIGRhdGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRpbWVsaW5lLWRhdGUnKTtcbiAgdmFyIGNhcmRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRpbWVsaW5lX19jYXJkcycpO1xuXG4gIHZhciBkcmFnZ2FibGUgPSBuZXcgUGxhaW5EcmFnZ2FibGUocmVkUGluKTtcblxuICBQbGFpbkRyYWdnYWJsZS5kcmFnZ2FibGVDdXJzb3IgPSAnZ3JhYic7XG4gIFBsYWluRHJhZ2dhYmxlLmRyYWdnaW5nQ3Vyc29yID0gJ2dyYWJiaW5nJztcblxuICB2YXIgaW5pdFRpbWVsaW5lID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBzY3JlZW5XaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCB8fCBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoO1xuXG4gICAgaWYgKHNjcmVlbldpZHRoIDwgNzY3KSB7XG4gICAgICBkcmFnZ2FibGUuc25hcCA9IHt4OiB7c3RhcnQ6IDY1LCBzdGVwOiA2NywgY2VudGVyOiB0cnVlfSwgeTogMH07XG4gICAgfSBlbHNlIGlmIChzY3JlZW5XaWR0aCA+IDc2NyAmJiBzY3JlZW5XaWR0aCA8IDEwMjMpIHtcbiAgICAgIGRyYWdnYWJsZS5zbmFwID0ge3g6IHtzdGFydDogNjUsIHN0ZXA6IDY3LCBjZW50ZXI6IHRydWV9LCB5OiAwfTtcbiAgICB9IGVsc2UgaWYgKHNjcmVlbldpZHRoID4gMTAyMyAmJiBzY3JlZW5XaWR0aCA8IDE0MzkpIHtcbiAgICAgIGRyYWdnYWJsZS5zbmFwID0ge3g6IHtzdGFydDogNTUsIHN0ZXA6IDY3LCBjZW50ZXI6IHRydWUsIGVuZDogODcxfSwgeTogMH07XG4gICAgfSBlbHNlIGlmIChzY3JlZW5XaWR0aCA+IDE0MzkpIHtcbiAgICAgIGRyYWdnYWJsZS5zbmFwID0ge3g6IHtzdGFydDogMTA1LCBzdGVwOiA4NywgY2VudGVyOiB0cnVlLCBlbmQ6IDEyMDB9LCB5OiAwfTtcbiAgICB9XG5cbiAgICBkb3RzLmZvckVhY2goZnVuY3Rpb24gKGVsZW0sIGkpIHtcbiAgICAgIHZhciByZWN0MSA9IHJlZFBpbi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIHZhciByZWN0MiA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICBpZiAocmVjdDEubGVmdCA+IHJlY3QyLmxlZnQgLSAxNSAmJiByZWN0MS5sZWZ0IDwgcmVjdDIubGVmdCArIDUpIHtcbiAgICAgICAgZGF0ZXMuZm9yRWFjaChmdW5jdGlvbiAoZWwsIG4pIHtcbiAgICAgICAgICBlbC5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7XG4gICAgICAgICAgY2FyZHNbbl0uc3R5bGUuY3NzVGV4dCA9ICdkaXNwbGF5OiBub25lOyc7XG4gICAgICAgIH0pO1xuICAgICAgICBkYXRlc1tpXS5zdHlsZS5jc3NUZXh0ID0gJ2NvbG9yOiByZ2JhKDIwOCwgMiwgMjcsIDEpOyc7XG4gICAgICAgIGNhcmRzW2ldLnN0eWxlLmNzc1RleHQgPSAnZGlzcGxheTogZmxleDsnO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIGluaXRUaW1lbGluZSgpO1xuXG4gIGRyYWdnYWJsZS5vbk1vdmUgPSBpbml0VGltZWxpbmU7XG4gIGRyYWdnYWJsZS5vbkRyYWcgPSBmdW5jdGlvbiAobmV3UG9zaXRpb24pIHtcbiAgICByZXR1cm4gISFuZXdQb3NpdGlvbi5zbmFwcGVkO1xuICB9O1xuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBmdW5jdGlvbiAoKSB7XG4gICAgaW5pdFRpbWVsaW5lKCk7XG4gIH0pO1xufSkoKTtcbiIsIid1c2Ugc3RyaWN0JztcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAkKCcjZmVlZGJhY2stZm9ybV9fdGVsJykubWFzaygnKzkgKDk5OSkgOTk5LTk5OTknKTtcbn0pO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdtYWluJyk7XG59KSgpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgbXlTd2lwZXIgPSB1bmRlZmluZWQ7XG5cbiAgZnVuY3Rpb24gaW5pdFN3aXBlcigpIHtcbiAgICB2YXIgc2NyZWVuV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggfHwgZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDtcbiAgICB2YXIgaXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW52ZXN0b3JzLXNsaWRlci1jb250YWluZXInKTtcbiAgICB2YXIgc2xpZGVXcmFwcGVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnZlc3RvcnMtc2xpZGVyLWNvbnRhaW5lciAuaXRlbV9fY29udGVudCcpO1xuICAgIHZhciBzbGlkZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaXRlbS1jYXJkJyk7XG5cbiAgICBpZiAoc2NyZWVuV2lkdGggPCA3NjcgJiYgbXlTd2lwZXIgPT09IHVuZGVmaW5lZCkge1xuXG4gICAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgnc3dpcGVyLWNvbnRhaW5lcicpO1xuICAgICAgfSk7XG5cbiAgICAgIHNsaWRlV3JhcHBlcnMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoJ3N3aXBlci13cmFwcGVyJyk7XG4gICAgICB9KTtcblxuICAgICAgc2xpZGVzLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCdzd2lwZXItc2xpZGUnKTtcbiAgICAgIH0pO1xuXG4gICAgICBteVN3aXBlciA9IG5ldyBTd2lwZXIoJy5zd2lwZXItY29udGFpbmVyJywge1xuICAgICAgICBkaXJlY3Rpb246ICdob3Jpem9udGFsJyxcbiAgICAgICAgbG9vcDogZmFsc2UsXG4gICAgICAgIHNwYWNlQmV0d2VlbjogOCxcbiAgICAgICAgc2xpZGVzT2Zmc2V0QWZ0ZXI6IDMwLFxuICAgICAgICBzbGlkZXNQZXJWaWV3OiAnYXV0bycsXG4gICAgICB9KTtcblxuICAgIH0gZWxzZSBpZiAoc2NyZWVuV2lkdGggPiA3NjcgJiYgbXlTd2lwZXIgIT09IHVuZGVmaW5lZCkge1xuXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc3dpcGVyLWNvbnRhaW5lcicpLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgZWxlbS5zd2lwZXIuZGVzdHJveSgpO1xuICAgICAgfSk7XG5cbiAgICAgIG15U3dpcGVyID0gdW5kZWZpbmVkO1xuXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc3dpcGVyLXdyYXBwZXInKS5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIGVsZW0ucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScpO1xuICAgICAgfSk7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc3dpcGVyLXNsaWRlJykuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICBlbGVtLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgnc3dpcGVyLWNvbnRhaW5lcicpO1xuICAgICAgfSk7XG5cbiAgICAgIHNsaWRlV3JhcHBlcnMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ3N3aXBlci13cmFwcGVyJyk7XG4gICAgICB9KTtcblxuICAgICAgc2xpZGVzLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdzd2lwZXItc2xpZGUnKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGluaXRTd2lwZXIoKTtcblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZnVuY3Rpb24gKCkge1xuICAgIGluaXRTd2lwZXIoKTtcbiAgfSk7XG59KSgpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24oKSB7XG4gIGlmICh3aW5kb3cuaW5uZXJXaWR0aCA8IDc2OCkge1xuICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZGlyZWN0aW9ucycpO1xuICAgIHZhciB3cmFwcGVyID0gY29udGFpbmVyLmNoaWxkcmVuWzBdO1xuICAgIHZhciBzbGlkZXMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLmRpcmVjdGlvbnNfX2l0ZW0nKTtcbiAgICB2YXIgcGFnaW5hdGlvbiA9IGNvbnRhaW5lci5jaGlsZHJlblsxXTtcblxuICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdzd2lwZXItY29udGFpbmVyJyk7XG4gICAgd3JhcHBlci5jbGFzc0xpc3QuYWRkKCdzd2lwZXItd3JhcHBlcicpO1xuICAgIHBhZ2luYXRpb24uY2xhc3NMaXN0LmFkZCgnc3dpcGVyLXBhZ2luYXRpb24nKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2xpZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBzbGlkZXNbaV0uY2xhc3NMaXN0LmFkZCgnc3dpcGVyLXNsaWRlJyk7XG4gICAgfVxuICB9XG5cbiAgaWYgKHdpbmRvdy5pbm5lcldpZHRoID4gNzY3KSB7XG4gICAgJC5zY3JvbGxpZnkoe1xuICAgICAgc2VjdGlvbiA6IFwiLnNjcmVlblwiLFxuICAgIH0pO1xuXG4gICAgdmFyIGNvbnRyb2xsZXIgPSBuZXcgU2Nyb2xsTWFnaWMuQ29udHJvbGxlcigpO1xuXG4gICAgbmV3IFNjcm9sbE1hZ2ljLlNjZW5lKHtcbiAgICAgIG9mZnNldDogMTI1XG4gICAgfSlcbiAgICAuc2V0Q2xhc3NUb2dnbGUoJyNzaWRlYmFyJywgJ3Nob3cnKVxuICAgIC5hZGRUbyhjb250cm9sbGVyKTtcblxuICAgIHZhciBudW1iZXJzU2NlbmUgPSBuZXcgU2Nyb2xsTWFnaWMuU2NlbmUoe1xuICAgICAgdHJpZ2dlckVsZW1lbnQ6ICcubnVtYmVycydcbiAgICB9KVxuICAgIC5zZXRDbGFzc1RvZ2dsZSgnI251bWJlcnMnLCAnYW5pbWF0ZScpXG4gICAgLmFkZFRvKGNvbnRyb2xsZXIpO1xuXG4gICAgdmFyIG5ld3NTY2VuZSA9IG5ldyBTY3JvbGxNYWdpYy5TY2VuZSh7XG4gICAgICB0cmlnZ2VyRWxlbWVudDogJy5uZXdzJ1xuICAgIH0pXG4gICAgLnNldENsYXNzVG9nZ2xlKCcjbmV3cycsICdhbmltYXRlJylcbiAgICAuYWRkVG8oY29udHJvbGxlcik7XG5cbiAgICB2YXIgZGlyZWN0aW9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kaXJlY3Rpb25zX19pdGVtJyk7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRpcmVjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIG5ldyBTY3JvbGxNYWdpYy5TY2VuZSh7XG4gICAgICAgIHRyaWdnZXJFbGVtZW50OiBkaXJlY3Rpb25zW2ldLFxuICAgICAgICB0cmlnZ2VySG9vazogMFxuICAgICAgfSlcbiAgICAgIC5zZXRQaW4oZGlyZWN0aW9uc1tpXSlcbiAgICAgIC5hZGRUbyhjb250cm9sbGVyKTtcbiAgICB9XG5cbiAgICBmb3IgKHZhciBpID0gMTsgaSA8IGRpcmVjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIG5ldyBTY3JvbGxNYWdpYy5TY2VuZSh7XG4gICAgICAgIHRyaWdnZXJFbGVtZW50OiBkaXJlY3Rpb25zW2ldLFxuICAgICAgICB0cmlnZ2VySG9vazogMFxuICAgICAgfSlcbiAgICAgIC5zZXRDbGFzc1RvZ2dsZShkaXJlY3Rpb25zW2ldLCAnc2hvdycpXG4gICAgICAuYWRkVG8oY29udHJvbGxlcik7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCBkaXJlY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICBuZXcgU2Nyb2xsTWFnaWMuU2NlbmUoe1xuICAgICAgICB0cmlnZ2VyRWxlbWVudDogZGlyZWN0aW9uc1tpXSxcbiAgICAgICAgdHJpZ2dlckhvb2s6IDBcbiAgICAgIH0pXG4gICAgICAuc2V0Q2xhc3NUb2dnbGUoZGlyZWN0aW9uc1tpIC0gMV0sICdmYWRlJylcbiAgICAgIC5hZGRUbyhjb250cm9sbGVyKTtcbiAgICB9XG5cbiAgICB2YXIgY2FyZWVyU2NlbmUgPSBuZXcgU2Nyb2xsTWFnaWMuU2NlbmUoe1xuICAgICAgdHJpZ2dlckVsZW1lbnQ6ICcudmlkZW8nLFxuICAgICAgdHJpZ2dlckhvb2s6IDBcbiAgICB9KVxuICAgIC5hZGRUbyhjb250cm9sbGVyKTtcblxuICAgIHZhciBtYWluID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWFpbicpO1xuICAgIHZhciBjYXJlZXIgPSBtYWluLnF1ZXJ5U2VsZWN0b3IoJy5jYXJlZXInKTtcbiAgICB2YXIgZmFrZVNjcmVlbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG4gICAgZmFrZVNjcmVlbi5pZCA9ICdmYWtlLWNhcmVlcic7XG4gICAgZmFrZVNjcmVlbi5zdHlsZS5oZWlnaHQgPSAnMTAwdmgnO1xuICAgIGZha2VTY3JlZW4uY2xhc3NMaXN0LmFkZCgnc2NyZWVuJyk7XG4gICAgbWFpbi5hcHBlbmRDaGlsZChmYWtlU2NyZWVuKTtcblxuICAgIG5ldyBTY3JvbGxNYWdpYy5TY2VuZSh7XG4gICAgICB0cmlnZ2VyRWxlbWVudDogJyN2aWRlbycsXG4gICAgICB0cmlnZ2VySG9vazogMFxuICAgIH0pXG4gICAgLnNldENsYXNzVG9nZ2xlKCcjY2FyZWVyJywgJ2ZpeGVkJylcbiAgICAuYWRkVG8oY29udHJvbGxlcik7XG5cbiAgICBuZXcgU2Nyb2xsTWFnaWMuU2NlbmUoe1xuICAgICAgdHJpZ2dlckVsZW1lbnQ6ICcjdmlkZW8nLFxuICAgICAgdHJpZ2dlckhvb2s6IDBcbiAgICB9KVxuICAgIC5zZXRDbGFzc1RvZ2dsZSgnI2NhcmVlcicsICdhbmltYXRlJylcbiAgICAuYWRkVG8oY29udHJvbGxlcik7XG5cbiAgICBuZXcgU2Nyb2xsTWFnaWMuU2NlbmUoe1xuICAgICAgdHJpZ2dlckVsZW1lbnQ6ICcjdmlkZW8nLFxuICAgICAgdHJpZ2dlckhvb2s6IDBcbiAgICB9KVxuICAgIC5zZXRDbGFzc1RvZ2dsZSgnI2Zvb3RlcicsICdhbmltYXRlJylcbiAgICAuYWRkVG8oY29udHJvbGxlcik7XG4gIH1cbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIGlmICh3aW5kb3cuaW5uZXJXaWR0aCA8IDc2OCAmJiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3dpcGVyLWNvbnRhaW5lcicpKSB7XG4gICAgdmFyIHN3aXBlciA9IG5ldyBTd2lwZXIoJy5zd2lwZXItY29udGFpbmVyJywge1xuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICBlbDogJy5zd2lwZXItcGFnaW5hdGlvbicsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG59KSgpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgc2lkZWJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaWRlYmFyJyk7XG4gIHZhciBidXR0b24gPSBzaWRlYmFyLnF1ZXJ5U2VsZWN0b3IoJy5zaWRlYmFyX19idXR0b24nKTtcblxuICBpZiAoc2lkZWJhcikge1xuICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCdzaWRlYmFyX19idXR0b24tLWNsb3NlJyk7XG4gICAgfSk7XG4gIH1cbn0pKCk7XG4iLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBidXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbicpO1xuICB2YXIgY29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fY29udGFpbmVyJyk7XG5cbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2dCkge1xuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnRlbnQuY2xhc3NMaXN0LmFkZCgncG9wdXBfX2NvbnRhaW5lci0tY2xvc2UnKTtcbiAgfSk7XG59KSgpO1xuIl19
