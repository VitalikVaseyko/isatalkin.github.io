$(function(){var e="default",t="default",i=0,n={pageNumber:1};$(".js-tabs").length&&$(".js-tab-control").on("click",function(){var e=$(this).closest(".js-tabs").find(".js-tab"),t=$(this).index();n.pageNumber=1,n.tab=this.id,$(this).siblings().removeClass("active"),$(this).addClass("active"),e.removeClass("active"),$.each(e,function(){$(this).index()===t&&($(this).addClass("active"),console.log(this),p(),l(m))})});var s=function(e,t){null===e?t.setAttribute("style","display: none"):t.setAttribute("style","display: block")},r=document.querySelector(".filters").parentNode,l=function(e){var t,i,s=function(e){var t=new XMLHttpRequest;return t.responseType="json",t.addEventListener("load",function(){200===t.status?e(t.response):console.log("Статус ответа: "+t.status+" "+t.statusText)}),t.addEventListener("error",function(){console.log("Произошла ошибка соединения")}),t.addEventListener("timeout",function(){console.log("Запрос не успел выполниться за "+t.timeout+"мс")}),t.timeout=1e4,t}(e),r=(t=n,i="",i+=document.getElementsByClassName("filters")[0].getAttribute("action"),0!==Object.keys(n).length&&(i+="?",void 0!==t.tab&&(i=i+"type="+t.tab+"&"),void 0!==t.pageNumber&&null!==t.pageNumber?i=i+"page="+t.pageNumber+"&":(t.pageNumber=1,i=i+"page="+t.pageNumber+"&"),void 0!==t.direction&&"default"!==t.direction?i=i+"direction="+t.direction+"&":i+="direction=&",void 0!==t.year&&"default"!==t.year?i=i+"year="+t.year+"&":i+="year=&"),console.log(n),console.log(i),i);s.open("GET",r),s.send()},a="",o="",c="";r.classList.contains("publications")?(a=".publications__list",o=".publications__item",c="#pubs-template"):r.classList.contains("news-journal__filter-wrapper")&&(a=".news-list",o=".news-list__item",c="#news-template");var u=document.querySelector(a),d=document.querySelector(c).content.querySelector(o),f=document.createDocumentFragment(),_=function(e){var t,i,n=d.cloneNode(!0);return r.classList.contains("publications")?(null!==e.external_link?(n.querySelector(".publications__data-wrapper").href=e.external_link,n.querySelector(".publications__data-wrapper").setAttribute("target","_blank")):n.querySelector(".publications__data-wrapper").href=e.internal_link,n.querySelector("h4").textContent=e.title,n.querySelector("p").textContent=e.authors,null!==e.image?n.querySelector("img").setAttribute("data-src",e.image):(i=(t=n.querySelector(".publications__item-wrapper")).querySelector(".publications__img"),t.removeChild(i)),void 0!==e.direction&&null!==e.direction&&(n.querySelector(".marking-publication__section").href=e.direction.link,n.querySelector(".marking-publication__section").innerHTML=e.direction.title),void 0!==e.year?n.querySelector(".marking-publication__year").innerHTML=e.year:n.querySelector(".marking-publication__year").setAttribute("style","display: none")):r.classList.contains("news-journal__filter-wrapper")&&(n.querySelector("a").href=e.link,n.querySelector("a").textContent=e.title,n.querySelector(".news-preview__text").textContent=e.annotation,n.querySelector(".news-preview__date").textContent=e.date,null!==e.preview_image?n.querySelector("img").setAttribute("data-src",e.preview_image):(i=(t=n.querySelector(".news-preview__inner")).querySelector(".news-preview__img"),t.removeChild(i))),n},p=function(){var e;if(r.classList.contains("publications")){for(e=document.querySelector(".publications__list");e.firstChild;)e.removeChild(e.firstChild);console.log("cleared pubs")}else if(r.classList.contains("news-journal__filter-wrapper")){Array.from(document.querySelectorAll(".js-tab")).forEach(function(e){if(e.classList.contains("active"))for(var t=e.querySelector(".news-list");t.firstChild;)t.removeChild(t.firstChild),console.log("cleared news")})}},m=function(e){null!=e&&e.results.forEach(function(t){if(console.log("hi"),r.classList.contains("publications")){f.appendChild(_(t)),u.appendChild(f);var i=r.querySelector(".publications__btn");s(e.next,i)}else if(r.classList.contains("news-journal__filter-wrapper")){var n;Array.from(document.querySelectorAll(".js-tab")).forEach(function(i){if(i.classList.contains("active")){f.appendChild(_(t));var r=(n=i).querySelector(".news-journal__btn");s(e.next,r),(u=n.querySelector(".news-list")).appendChild(f)}})}})};if(r.classList.contains("publications")&&(p(),l(m)),null!==document.querySelector(".tab-controls")){var y=document.getElementsByClassName("js-tab-control active")[0];n.tab=y.id,l(m)}var v=function(e){"default"===e.value?e.classList.add("filters__select--default"):e.classList.remove("filters__select--default")},b=function(e,t,i){var s=document.querySelector(t);"default"!==e.value&&"default"===i&&s.classList.add("filters__moving"),"default"===e.value&&s.classList.remove("filters__moving"),"directions"===e.id?n.direction=e.value:"year"===e.id&&(n.year=e.value)},g=function(){var e=document.querySelector(".filters__select--direction"),t=document.querySelector(".filters__select--year");e.classList.contains("filters__select--default")&&t.classList.contains("filters__select--default")?S.classList.remove("filters__reset-button--shown"):S.classList.add("filters__reset-button--shown"),p()},h=document.querySelector(".filters__select--direction"),q=document.querySelector(".filters__select--year"),S=document.querySelector(".filters__reset-button");h.addEventListener("change",function(){v(h),b(h,".filters__standing--directions",t),g(),console.log(n),p(),l(m)}),q.addEventListener("change",function(){v(q),b(q,".filters__standing--years",e),g(),console.log(n),p(),l(m)});$(".js-btn-more").length&&$.each($(".js-btn-more"),function(){var e=$(this).closest(".js-items").find(".js-item");$.each(e,function(){$(this).index()>9&&$(this).hide()}),$(this).on("click",function(t){t.preventDefault(),e.show(),i=n.pageNumber+1,n.pageNumber=i,l(m)})}),S.addEventListener("click",function(){q.value="default",h.value="default",q.classList.add("filters__select--default"),h.classList.add("filters__select--default"),e="default",b(h,".filters__standing--directions",t="default"),b(q,".filters__standing--years",e),S.classList.remove("filters__reset-button--shown"),delete n.direction,delete n.years,p(),l(m)})});